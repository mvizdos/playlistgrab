<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PlaylistGrab.com â€“ Copy Any YouTube Playlist, Instantly</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="canonical" href="https://playlistgrab.com/">
  <meta name="description" content="Paste and export every video link from a public YouTube playlist. No distractions. Just instant, perfect results.">
  <!-- Minimal critical CSS (only what's needed for first paint) -->
  <style id="critical-css">
    html,body{background:#f6f8fd;margin:0;color:#232a3a}
    body{font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif}
    header{padding:20px 12px 6px 12px;text-align:center}
    h1{font-size:1.6rem;margin:.12rem 0;color:#2467fa}
    main{max-width:480px;margin:0 auto;padding:0 12px}
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- Preconnect common third-party domains used for icons and images -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://github.githubassets.com" crossorigin>
  <link rel="preconnect" href="https://upload.wikimedia.org">
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" as="style" onload="this.rel='stylesheet'">
  <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet"></noscript>
  <style>
:root {
  --primary: #2467fa;
  --primary-dark: #193e89;
  --success: #36ca89;
  --danger: #e54e5e;
  --background: #f6f8fd;
  --panel: #fff;
  --dark-bg: #1d232f;
  --dark-panel: #202737;
  --border: #b6cdf2;
  --radius: 18px;
  --shadow: 0 4px 24px 0 rgba(60,60,140,0.13);
  --venmo: #3d95ce;
}
@media (prefers-reduced-motion: no-preference) {
  .fade-in {
    animation: fadeSlideIn .62s cubic-bezier(.33,1.02,.62,.99) 1;
  }
  @keyframes fadeSlideIn {
    from { opacity:0; transform: translateY(20px);}
    to { opacity:1; transform:translateY(0);}
  }
  .toast-anim {
    animation: toastUp .5s cubic-bezier(.41,1.07,.55,1.05);
  }
  @keyframes toastUp {
    0% { opacity:0; transform:translateY(40px);}
    90% { opacity:1;}
    100% { opacity:1; transform:translateY(0);}
  }
}
body, html {
  background: var(--background); min-height:100vh; margin:0; color: #232a3a;
  font-family: 'Inter',Avenir,Segoe UI,Arial,sans-serif; font-size: 17px; line-height: 1.58;
}
/* Make off-screen skip link visible when focused for accessibility */
.skip-link:focus {
  position: static !important; left: auto !important; top: auto !important; width: auto !important; height: auto !important;
  padding: .5em .75em; background: #000; color: #fff; border-radius: 4px; z-index: 10000; text-decoration: none;
}
/* Visible focus for interactive elements (buttons, links, inputs) */
button:focus-visible, a:focus-visible, input:focus-visible, textarea:focus-visible {
  outline: 3px solid #34e6d1; outline-offset: 2px; border-radius: 6px;
}
/* Position dark mode toggle */
#darkmode-toggle{position:fixed;right:21px;top:13px;font-size:2em;border:none;background:none;z-index:1001;cursor:pointer}
/* Footer link color */
footer a{color:#8ad}
/* Hidden utility + reveal animation for nicer show/hide */
.hidden{display:none!important;opacity:0;}
.reveal{animation:fadeIn .34s cubic-bezier(.2,.9,.28,1) forwards; transform-origin:50% 50%;}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px) scale(.985)}50%{transform:translateY(3px) scale(.992)}to{opacity:1;transform:translateY(0) scale(1)}}
body.dark {background:var(--dark-bg);color:#e8eefa;}
header {
  text-align:center;margin:0 0 28px 0;padding:32px 0 8px 0;
}
h1{font-size:2.05em;letter-spacing:-2px;font-weight:900;margin:.1em 0 0.34em 0;color:var(--primary);}
.tagline{font-size:1.2em;font-weight:800;letter-spacing:-.25px;margin-bottom:3px; color:var(--primary-dark);}
.howto{font-size:1.09em;font-weight:600;margin-bottom:1px;color:#4e6ddb;}
main{max-width:480px;width:97vw;margin:0 auto;}
.panel{
  background:var(--panel);border-radius:var(--radius);box-shadow:var(--shadow);
  padding:30px 21px 19px 21px;margin-bottom:32px;border:1.5px solid var(--border);}
body.dark .panel{background:var(--dark-panel);border:1.5px solid #5970b4;}
label{font-weight:700;letter-spacing:-0.5px;}
.input-center-wrap{display:flex;justify-content:center;align-items:center;width:100%;}
input[type="text"]{
  font-size:1.15em;padding:13px;margin-bottom:13px;border-radius:10px;
  border:1.5px solid #b6cdf2;background:#f3f6ff;text-align:center;min-width:260px;max-width:480px;width:100%;box-sizing:border-box;
  margin-left:auto;margin-right:auto;display:block;
}
body.dark input[type="text"]{background:#232741;color:#eaf1fc;border:1.5px solid #355096;}
input[type="text"]:focus{border-color:var(--primary);}
#extract-btn, .export-btn, .danger-btn {
  background:var(--primary);color:#fff;font-weight:700;padding:13px 40px;
  font-size:1.12em;border:none;border-radius:900px;cursor:pointer;
  transition:background .13s,box-shadow .17s,transform 0.10s;outline:none;margin:0 auto 15px auto;text-align:center;box-shadow:0 1px 6px 0 rgba(90,113,200,0.07);
  display:block
}
#extract-btn:not(:disabled):hover, #extract-btn:not(:disabled):focus-visible {
  box-shadow:0 3px 16px 0 rgba(70,130,220,0.14);
  animation: pulseBtn 0.53s cubic-bezier(.34,1.21,.6,1.02) 1 alternate;
}
@media (prefers-reduced-motion: no-preference) {
  @keyframes pulseBtn{0%{transform:scale(1);}70%{transform:scale(1.08);}100%{transform:scale(1);}}
}
#extract-btn:disabled{background:#bfcedc;color:#e9f3fb;cursor:not-allowed;}
.export-btn,.danger-btn{display:inline-block;margin:0 8px 0 8px;}
.export-btn:active, #extract-btn:active, .danger-btn:active{transform:scale(.96);}
.danger-btn{background:var(--danger)!important;}

/* Micro-interactions: subtle press and hover polish */
#extract-btn, .export-btn, .danger-btn, .venmo-btn, .footer-icon { will-change: transform, box-shadow; transition: transform .12s cubic-bezier(.2,.9,.3,1), box-shadow .12s ease; }
#extract-btn:hover, .export-btn:hover, .venmo-btn:hover, .footer-icon:hover { transform: translateY(-2px) scale(1.003); box-shadow: 0 6px 20px rgba(30,50,120,0.08); }
#extract-btn:active, .export-btn:active, .venmo-btn:active, .footer-icon:active { transform: translateY(0) scale(.985); box-shadow: 0 3px 12px rgba(20,30,80,0.12); }
#extract-btn[disabled], .export-btn[disabled] { transform: none; box-shadow: none; }
.center-bar{display:flex;justify-content:center;align-items:center;gap:16px;}
#reset-btn{display:block;margin:26px auto 4px auto;}
.results-wrap{margin:36px 0 0 0;}
.output-title{font-size:1.16em;font-weight:800;margin-bottom:10px;letter-spacing:-.07px;text-align:center;}
.outputbox{box-shadow:0 2px 12px 0 rgba(30,40,90,0.11);border-radius:12px;border:1.8px solid #2467fa;background:#fafdff;margin-bottom:18px;}
body.dark .outputbox{border:1.9px solid #34e6d1;background:#161c2a;}
#output{width:100%;min-height:84px;border:none;background:none;padding:13px 7px;font-size:1.05em;color:#183042;outline:none;resize:vertical;}
body.dark #output{color:#eaeffa;}
#toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(0);background:var(--success);border-radius:13px;padding:13px 26px;font-size:1.04em;color:#fff;font-weight:500;box-shadow:0 2px 15px 0 rgba(30,160,80,0.13);opacity:0;z-index:2000;pointer-events:none;}
#toast.active{opacity:1;}
.toast-anim{animation:toastIn .46s cubic-bezier(.2,.9,.28,1) forwards}
@keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(18px) scale(.98)}50%{transform:translateX(-50%) translateY(6px) scale(.993)}to{opacity:1;transform:translateX(-50%) translateY(0) scale(1)}}

/* Toast close button */
.toast-close{position:absolute;right:8px;top:6px;background:none;border:none;color:rgba(255,255,255,0.9);font-size:1rem;cursor:pointer;padding:6px;border-radius:6px;}
.toast-close:focus{outline:2px solid rgba(255,255,255,0.75)}
.toast-message{display:inline-block;padding-right:18px}
.toast.persistent{pointer-events:auto}
#error-message{color:#c11024;font-weight:700;padding:8px 13px 9px 13px;border-radius:8px;font-size:1.02em;margin-top:17px;background:#fff5f5;text-align:center;}
#how-link{text-align:center;display:block;font-weight:800;font-size:1.09em;margin:33px auto 9px auto;letter-spacing:.08em;color:#2253a8;}
#how-link:focus{outline:2.5px solid #34e6d1;}
footer{margin-top:45px;font-size:1em;text-align:center;color:#8ad;}
.footer-row{display:flex;align-items:center;justify-content:center;gap:23px;margin-bottom:7px;}
.footer-icon{display:flex;align-items:center;justify-content:center;background:#fff;border-radius:50%;width:38px;height:38px;transition:background .17s;}
.footer-icon img{height:21px;width:21px;}
.footer-icon:hover, .footer-icon:focus{background:#d7f6fb;}
body.dark .footer-icon{background:#1d283c;}
body.dark .footer-icon:hover, body.dark .footer-icon:focus{background:#243f49;}
.copyright{color:#98a7c4;}
.donate-wrap{text-align:center;}
.venmo-btn {
  background:var(--venmo);color:#fff;border:none;border-radius:19px;padding:.88em 2.55em;font-size:1.10em;font-weight:700;cursor:pointer;text-decoration:none;
  margin:15px auto 10px auto;display:inline-flex;align-items:center;gap:10px;transition:background .2s;
}
.venmo-btn .venmo-icon-bg {background: #fff; border-radius: 50%; display:inline-flex;align-items:center;justify-content:center;padding:4px;width:2.1em;height:2.1em;}
.venmo-btn img{display:inline-block;height:1.38em;width:1.38em;vertical-align:middle;}
.venmo-btn:hover,.venmo-btn:focus{background:#276eaa;outline:2.5px solid #31c6dc;}
.venmo-note{display:block;margin-top:8px;color:#245b94;font-size:1.04em;}
body.dark .venmo-note{color:#77e4d3;}
@media (max-width:650px){
  .panel, .outputbox{padding:11px 1vw;}
  main{max-width:100vw;}
  h1{font-size:1.28em;}
  .tagline{font-size:1.02em;}
  .howto{font-size:.98em;}
  .center-bar{flex-direction:column;gap:10px;}
}
#how-modal {background:rgba(34,44,80,0.24);position:fixed;z-index:10001;top:0;left:0;right:0;bottom:0;display:none;align-items:center;justify-content:center;}
#how-modal.active {display:flex;}
#how-modal .help-modal-content { background:#fff; color:#223; border-radius:13px; padding:28px 22px; min-width:260px; max-width:355px; border:2.5px solid #2253a8; box-shadow:0 7px 35px 0 rgba(30,30,87,0.13);position:relative;text-align:left;}
body.dark #how-modal .help-modal-content {background:#1b2433;color:#e8eef5;border-color:#34e6d1;}
#how-modal .onboard-close {position:absolute; right:13px; top:13px; background:none;border:none;font-size:1.18em;color:#496;line-height:1;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:50%;cursor:pointer;}
#how-modal .onboard-close:focus{outline:2px solid #28af80;}
.help-modal-content ul{margin-top:0; padding-left:21px; font-size:1.09em;}
.help-modal-content ul li{margin-bottom:10px;}
#how-modal-title{font-size:1.13em;margin-top:0}
/* Screen-reader helper */
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <a class="skip-link" href="#content">Skip to content</a>
  <button id="darkmode-toggle" aria-label="Toggle dark mode" title="Toggle Dark Mode">ðŸŒš</button>
  <header>
    <h1>PlaylistGrab.com</h1>
    <div class="tagline">Extract all your YouTube playlist links, instantly.</div>
    <div class="howto">Paste a playlist link below, click Extract, then copy or download your raw video URLs. As simple as it gets.</div>
  </header>
  <main id="content" role="main">
    <form class="panel" id="extractor-form" autocomplete="off">
      <label for="playlist">Playlist link</label>
      <div class="input-center-wrap">
        <input id="playlist" type="text" autocomplete="off"
          placeholder="https://www.youtube.com/playlist?list=..."
          aria-required="true" aria-label="YouTube playlist URL" aria-describedby="error-message" autofocus>
      </div>
  <button id="extract-btn" type="button" disabled>Extract Links</button>
  <div id="error-message" class="hidden" aria-live="polite"></div>
  <div id="spinner" class="spinner hidden" aria-label="Loading" role="status" aria-live="polite"></div>
  <section class="results-wrap hidden" id="output-section">
        <div class="output-title">Your Playlist Video Links</div>
        <div class="outputbox fade-in" id="outbox-anim">
          <textarea id="output" readonly spellcheck="false" aria-label="List of playlist video links" tabindex="0"></textarea>
        </div>
        <div class="center-bar">
          <button id="copy-btn" class="export-btn" type="button" tabindex="0" aria-label="Copy links to clipboard">Copy</button>
          <button id="txt-btn" class="export-btn" type="button" tabindex="0" aria-label="Download links as TXT">TXT</button>
          <button id="csv-btn" class="export-btn" type="button" tabindex="0" aria-label="Download links as CSV">CSV</button>
        </div>
  <button id="reset-btn" class="export-btn danger-btn" type="button" title="Clear everything and start over" tabindex="0">Start Over</button>
        <div class="donate-wrap" aria-label="Tip & Support">
          <span class="venmo-note">Like PlaylistGrab? Tip on Venmo:</span>
          <a href="https://venmo.com/mvizdos" target="_blank" rel="noopener noreferrer" title="Open Venmo (new tab)" class="venmo-btn" aria-label="Donate on Venmo">
            <span class="venmo-icon-bg"><img src="https://cdn.jsdelivr.net/npm/simple-icons@v11/icons/venmo.svg" alt="Venmo" aria-hidden="true" loading="lazy" decoding="async"></span>
              @mvizdos
            </a>
          </div>
        </section>
        <a href="#" id="how-link" tabindex="0" role="button" aria-haspopup="dialog" aria-controls="how-modal" aria-expanded="false">How This Works</a>
        <div id="how-modal" tabindex="-1" aria-modal="true" aria-labelledby="how-modal-title" role="dialog">
          <div class="help-modal-content" role="document">
            <button id="how-modal-close" aria-label="Close help modal" class="onboard-close">&#10005;</button>
            <h2 id="how-modal-title">How PlaylistGrab Works</h2>
            <ul>
              <li>Paste a <b>public</b> playlist URL.</li>
              <li>Press <b>Extract Links</b>â€”you get clean, direct URLs in a standard format.</li>
              <li>Copy, TXT, CSV: instantly download or share links (CSV = comma separated).</li>
              <li>Press <b>Escape</b> or X to close this guide.</li>
            </ul>
          </div>
        </div>
      </form>
  </main>
  <div id="toast" aria-live="polite" aria-atomic="true" role="status" tabindex="0">
    <button id="toast-close" class="toast-close" aria-label="Dismiss notification">âœ•</button>
    <span id="toast-message" class="toast-message"></span>
  </div>
  <div id="announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div>
  <footer>
    <div class="footer-row">
  <a class="footer-icon" href="https://youtube.mvizdos.com?utm_source=playlistgrab.com" target="_blank" rel="noopener noreferrer" title="Open YouTube profile (new tab)" aria-label="YouTube"><img src="https://upload.wikimedia.org/wikipedia/commons/4/42/YouTube_icon_%282013-2017%29.png" alt="YouTube" loading="lazy" decoding="async"></a>
  <a class="footer-icon" href="https://linkedin.mvizdos.com?utm_source=playlistgrab.com" target="_blank" rel="noopener noreferrer" title="Open LinkedIn profile (new tab)" aria-label="LinkedIn"><img src="https://cdn.jsdelivr.net/npm/simple-icons@v11/icons/linkedin.svg" alt="LinkedIn" loading="lazy" decoding="async"></a>
  <a class="footer-icon" href="https://bsky.mvizdos.com?utm_source=playlistgrab.com" target="_blank" rel="noopener noreferrer" title="Open Bluesky profile (new tab)" aria-label="Bluesky"><img src="https://cdn.jsdelivr.net/npm/simple-icons@v11/icons/bluesky.svg" alt="Bluesky" loading="lazy" decoding="async"></a>
  <a class="footer-icon" href="https://github.com/mvizdos?utm_source=playlistgrab.com" target="_blank" rel="noopener noreferrer" title="Open GitHub profile (new tab)" aria-label="GitHub"><img src="https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png" alt="GitHub" loading="lazy" decoding="async"></a>
  <a class="footer-icon" href="mailto:support@playlistgrab.com" rel="noopener noreferrer" title="Send email to support@playlistgrab.com" aria-label="Email"><img src="https://cdn.jsdelivr.net/npm/simple-icons@v11/icons/maildotru.svg" alt="Email" loading="lazy" decoding="async"></a>
    </div>
  <a href="privacy.html" tabindex="0">Privacy Policy</a> Â· <a href="tos.html" tabindex="0">Terms of Service</a>
    <div class="copyright">&copy; <span id="year"></span> PlaylistGrab.com</div>
  </footer>
<script>
document.addEventListener('DOMContentLoaded', function(){
  'use strict';
  document.getElementById('year').textContent = new Date().getFullYear();
  // Toast helpers
  const toastEl = document.getElementById('toast');
  const toastMsg = document.getElementById('toast-message');
  const toastClose = document.getElementById('toast-close');

  function closeToast() {
    if (!toastEl) return;
    toastEl.classList.remove('active','toast-anim','persistent','reveal');
    toastEl.removeAttribute('role');
    toastMsg.textContent = '';
    // remove listeners
    toastEl.removeEventListener('mouseenter', _clearTimer);
    toastEl.removeEventListener('mouseleave', _startTimer);
    toastEl.removeEventListener('focus', _clearTimer);
    toastEl.removeEventListener('blur', _startTimer);
    toastClose.removeEventListener('click', closeToast);
    _clearTimer();
  }
  let _timer = null;
  function _clearTimer(){ if(_timer){ clearTimeout(_timer); _timer = null; } }
  function _startTimer(ms){ _clearTimer(); _timer = setTimeout(()=>{ closeToast(); }, ms || 1500); }

  // Close button (guarded)
  if (toastClose) toastClose.addEventListener('click', closeToast);

  function showToast(msg, opts) {
    opts = opts || {};
    if (!toastEl) return;
    toastMsg.textContent = msg;
    // persistent: do not auto-hide
    if (opts.persistent) {
      toastEl.classList.add('persistent');
      toastEl.setAttribute('role', opts.role || 'alert');
    } else {
      toastEl.classList.remove('persistent');
      toastEl.setAttribute('role', opts.role || 'status');
    }
    toastEl.classList.add('active','toast-anim');

    // pause/resume behavior only for non-persistent
    _clearTimer();
    toastEl.removeEventListener('mouseenter', _clearTimer);
    toastEl.removeEventListener('mouseleave', _startTimer);
    toastEl.removeEventListener('focus', _clearTimer);
    toastEl.removeEventListener('blur', _startTimer);
    if (!opts.persistent) {
      toastEl.addEventListener('mouseenter', _clearTimer);
      toastEl.addEventListener('mouseleave', _startTimer);
      toastEl.addEventListener('focus', _clearTimer);
      toastEl.addEventListener('blur', _startTimer);
      _startTimer(opts.timeout || 1500);
    }
  }

  // expose to global scope for existing calls
  window.showToast = showToast;

  function setDarkMode(on) {
    document.body.classList.toggle('dark', !!on);
    localStorage.setItem('dark', !!on ? '1' : '0');
    document.getElementById('darkmode-toggle').textContent = !!on ? 'ðŸŒž' : "ðŸŒš";
  }
  (function(){
    let key = localStorage.getItem('dark');
    if (key === "1" || (key == null && window.matchMedia('(prefers-color-scheme: dark)').matches)) setDarkMode(true);
    document.getElementById('darkmode-toggle').onclick = () => setDarkMode(!document.body.classList.contains('dark'));
  })();
  function showToast(msg) {
    var t=document.getElementById('toast');
    t.textContent=msg; t.classList.add('active','toast-anim');
    // pause/resume behavior
    let timeout = 1500;
    let to = null;
    function clearTimer(){ if(to) { clearTimeout(to); to = null; } }
    function startTimer(){ clearTimer(); to = setTimeout(()=>{ t.classList.remove('active','toast-anim'); removeListeners(); }, timeout); }
    function removeListeners(){ t.removeEventListener('mouseenter',clearTimer); t.removeEventListener('mouseleave',startTimer); t.removeEventListener('focus',clearTimer); t.removeEventListener('blur',startTimer); }
    t.addEventListener('mouseenter', clearTimer);
    t.addEventListener('mouseleave', startTimer);
    t.addEventListener('focus', clearTimer);
    t.addEventListener('blur', startTimer);
    startTimer();
  }
  function isValidYoutubePlaylist(url) {
  // Accepts URLs like https://www.youtube.com/playlist?list=... or https://youtube.com/playlist?list=...
  // or https://www.youtube.com/watch?v=XXXXX&list=XXXXX
  // Blocks all other forms, including video/channel/user URLs.
  const full = url.trim();
  const playlistOnly = /^https:\/\/(www\.)?youtube\.com\/playlist\?list=([a-zA-Z0-9_-]{10,})$/;
  const videoWithList = /^https:\/\/(www\.)?youtube\.com\/watch\?v=[a-zA-Z0-9_-]{11,}&list=([a-zA-Z0-9_-]{10,})$/;
  return playlistOnly.test(full) || videoWithList.test(full);
}
function addUniversalButtonKeys(btn) {
  btn.addEventListener('keydown', function(e){
    if(e.key==="Enter"||e.key===" "){ e.preventDefault(); btn.click(); }
  });
}
['extract-btn','copy-btn','txt-btn','csv-btn','reset-btn','how-link','how-modal-close'].forEach(id=>{
  const el=document.getElementById(id);
  if(el)addUniversalButtonKeys(el);
});
const input = document.getElementById('playlist'),
      extractBtn = document.getElementById('extract-btn'),
      outputSection = document.getElementById('output-section'),
      outputBox = document.getElementById('output'),
      errorEl = document.getElementById('error-message'),
      spinner = document.getElementById('spinner'),
      copyBtn = document.getElementById('copy-btn'),
      txtBtn = document.getElementById('txt-btn'),
      csvBtn = document.getElementById('csv-btn'),
      resetBtn = document.getElementById('reset-btn'),
      outboxAnim = document.getElementById('outbox-anim');
let lines = [], rows = [];
function resetAll() {
  input.value = '';
  outputBox.value = '';
  lines = [];
  rows = [];
  errorEl.classList.add('hidden');
  outputSection.classList.add('hidden');
  spinner.classList.add('hidden');
  // remove any leftover reveal classes so animations retrigger cleanly
  errorEl.classList.remove('reveal');
  spinner.classList.remove('reveal');
  outputSection.classList.remove('reveal');
  extractBtn.disabled = true;
  extractBtn.classList.remove('hidden');
  input.removeAttribute('aria-disabled');
  input.removeAttribute('aria-invalid');
  input.focus();
}
input.addEventListener('input',function(){
  extractBtn.disabled = !isValidYoutubePlaylist(this.value);
  input.setAttribute('aria-invalid',extractBtn.disabled?"true":"false");
  errorEl.classList.add('hidden');
  errorEl.classList.remove('reveal');
});
input.addEventListener('keydown',function(e){
  if(e.key==="Enter" && !extractBtn.disabled){e.preventDefault();extractBtn.click();}
});
extractBtn.onclick = async function(){
  if (!isValidYoutubePlaylist(input.value.trim())) {
  errorEl.innerText = "Please enter a valid public YouTube playlist link (not a channel or video).";
  errorEl.classList.remove('hidden');
    input.focus();
    return;
  }
  errorEl.classList.add('hidden');
  errorEl.classList.remove('reveal');
  // show spinner with reveal animation
  spinner.classList.remove('hidden');
  spinner.classList.remove('reveal'); void spinner.offsetWidth; spinner.classList.add('reveal');
  outputSection.classList.add('hidden');
  outputSection.classList.remove('reveal');
  try{
    const playlistId = 'PLePF9OqSUSsI0rGE6zUAAiCY4XLNJ';
    const url = input.value.trim();
    lines = []; rows = [];
    let html;
    try {
      html = await fetch("https://corsproxy.io/?"+encodeURIComponent(url)).then(r=>r.text());
    } catch {
  spinner.classList.add('hidden');
  spinner.classList.remove('reveal');
  errorEl.innerText = "Could not load playlist. Try again or check your link.";
  errorEl.classList.remove('hidden'); errorEl.classList.remove('reveal'); void errorEl.offsetWidth; errorEl.classList.add('reveal'); return;
    }
    // Robust canonical videoId extraction
    let videoIds = new Set();
    try {
      const m = html.match(/var ytInitialData = (.*?);<\/script>/s);
      if(m){
        const data = JSON.parse(m[1]);
        let videoListObjs = data.contents.twoColumnBrowseResultsRenderer.tabs.tabRenderer.content
            .sectionListRenderer.contents.itemSectionRenderer.contents
            .playlistVideoListRenderer.contents;
        videoListObjs.forEach(item => {
          let r = item.playlistVideoRenderer;
          if (r && r.videoId && /^[a-zA-Z0-9_-]{11}$/.test(r.videoId)) {
            videoIds.add(r.videoId);
          }
        });
      }
    } catch(e){}
    // Fallback: regex any videoId in HTML (&v=XXXXXXXXXXX pattern):
    for (const m of html.matchAll(/[?&]v=([a-zA-Z0-9_-]{11})/g)) {
      videoIds.add(m[1]);
    }
    lines = Array.from(videoIds).map(
      vid => `https://www.youtube.com/watch?v=${vid}&list=${playlistId}`
    );
    rows = lines.map(url => [url]);
    spinner.classList.add('hidden');
    spinner.classList.remove('reveal');
    if(!lines.length){
      errorEl.innerText="Nothing found! Use a public playlist."; errorEl.classList.remove('hidden'); errorEl.classList.remove('reveal'); void errorEl.offsetWidth; errorEl.classList.add('reveal'); return;
    }
    outputBox.value = lines.join('\n');
    outputSection.classList.remove('hidden');
    outputSection.classList.add('reveal');
    setTimeout(()=>{outboxAnim&&outboxAnim.classList.add('fade-in');outputBox.focus();},30);
  }catch(e){
    spinner.classList.add('hidden');
    spinner.classList.remove('reveal');
    errorEl.innerText = "Failed to fetch playlist. Please check the link or your connection.";
    errorEl.classList.remove('hidden'); errorEl.classList.remove('reveal'); void errorEl.offsetWidth; errorEl.classList.add('reveal');
  }
};
copyBtn.onclick = () => {navigator.clipboard.writeText(outputBox.value);showToast("Copied to clipboard!");};
txtBtn.onclick = () => {
  let b=new Blob([outputBox.value],{type:'text/plain'}),l=document.createElement('a');
  l.href=URL.createObjectURL(b); l.download="playlistgrab-export.txt"; document.body.appendChild(l); l.click(); document.body.removeChild(l);
  showToast("TXT saved!");
};
csvBtn.onclick = ()=>{
  if(!rows.length) return;
  let csv = rows.map(r=>r[0]).join(',');
  let b=new Blob([csv], {type:'text/csv'}),l=document.createElement('a');
  l.href=URL.createObjectURL(b); l.download="playlistgrab-export.csv"; document.body.appendChild(l); l.click(); document.body.removeChild(l);
  showToast("CSV saved!");
};
resetBtn.onclick = ()=>{resetAll();};
// Modal with focus trap
const howModal = document.getElementById('how-modal'),
      howLink = document.getElementById('how-link'),
      howClose = document.getElementById('how-modal-close');
let _previouslyFocused = null;

function getFocusableElements(container) {
  return Array.from(container.querySelectorAll('a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])'))
    .filter(el => !el.hasAttribute('disabled') && el.offsetParent !== null);
}

function openModal() {
  _previouslyFocused = document.activeElement;
  howModal.classList.add('active');
  const focusables = getFocusableElements(howModal);
  if (focusables.length) focusables[0].focus(); else howModal.focus();
  document.addEventListener('keydown', trapTabKey);
  const ann = document.getElementById('announcer');
  if (ann) ann.textContent = 'Help dialog opened. Press Escape to close.';
}

function closeModal() {
  howModal.classList.remove('active');
  document.removeEventListener('keydown', trapTabKey);
  if (_previouslyFocused && typeof _previouslyFocused.focus === 'function') _previouslyFocused.focus();
  const ann = document.getElementById('announcer');
  if (ann) ann.textContent = 'Help dialog closed.';
}

function trapTabKey(e) {
  if (e.key !== 'Tab') return;
  const focusables = getFocusableElements(howModal);
  if (!focusables.length) { e.preventDefault(); return; }
  const first = focusables[0];
  const last = focusables[focusables.length - 1];
  if (e.shiftKey) { // shift + tab
    if (document.activeElement === first) { e.preventDefault(); last.focus(); }
  } else { // tab
    if (document.activeElement === last) { e.preventDefault(); first.focus(); }
  }
}

howLink.addEventListener('click', function(e){ e.preventDefault(); openModal(); });
howClose.addEventListener('click', function(){ closeModal(); });
howModal.addEventListener('keydown', function(e){ if(e.key === 'Escape') closeModal(); });
howModal.addEventListener('mousedown', function(e){ if(e.target === howModal) closeModal(); });
});
</script>
</body>
</html>
